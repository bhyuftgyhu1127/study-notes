# Redis面试题（2020最新版）

<img src="D:\学习笔记\imge\redis.png" style="zoom: 80%;" />.

## 概述

### 什么是Redis

Redis(Remote Dictionary Server) 是一个开源的高性能非关系型（NoSQL）的键值对数据库。

Redis 可以存储键和五种不同类型的值之间的映射。键的类型只能为字符串，值支持五种数据类型：

<table><tr><td bgcolor="yellow">字符串、列表、集合、散列表、有序集合</td></tr></table>

与传统数据库不同的是 Redis 的数据是存在内存中的，所以读写速度非常快，因此 redis 被广泛应用于缓存方向，每秒可以处理超过 10万次读写操作，是已知性能最快的Key-Value DB。

### Redis有哪些优缺点

优点

- 读写性能优异， Redis能读的速度是110000次/s，写的速度是81000次/s。
- 支持数据持久化，支持AOF和RDB两种持久化方式。
- 支持事务，Redis的所有操作都是原子性的，同时Redis还支持对几个操作合并后的原子性执行。
- 数据结构丰富，除了支持string类型的value外还支持hash、set、zset、list等数据结构。
- 支持主从复制，主机会自动将数据同步到从机，可以进行读写分离。

缺点

- 数据库容量受到物理内存的限制，不能用作海量数据的高性能读写，因此Redis适合的场景主要局限在较小数据量的高性能操作和运算上。
- Redis 不具备自动容错和恢复功能，主机从机的宕机都会导致前端部分读写请求失败，需要等待机器重启或者手动切换前端的IP才能恢复。
- 主机宕机，宕机前有部分数据未能及时同步到从机，切换IP后还会引入数据不一致的问题，降低了系统的可用性。
- Redis 较难支持在线扩容，在集群容量达到上限时在线扩容会变得很复杂。为避免这一问题，运维人员在系统上线时必须确保有足够的空间，这对资源造成了很大的浪费。

### 为什么要用 Redis /为什么要用缓存

主要从“高性能”和“高并发”这两点来看待这个问题。

**高性能：**

假如用户第一次访问数据库中的某些数据。这个过程会比较慢，因为是从硬盘上读取的。将该用户访问的数据存在数缓存中，这样下一次再访问这些数据的时候就可以直接从缓存中获取了。操作缓存就是直接操作内存，所以速度相当快。如果数据库中的对应数据改变的之后，同步改变缓存中相应的数据即可！

<img src="D:\学习笔记\imge\redis01.png" style="zoom:90%;" />.

**高并发：**

直接操作缓存能够承受的请求是远远大于直接访问数据库的，所以我们可以考虑把数据库中的部分数据转移到缓存中去，这样用户的一部分请求会直接到缓存这里而不用经过数据库。

![](D:\学习笔记\imge\高并发.png).



### 什么是redis缓存穿透、缓存击穿、缓存雪崩？如何解决？

从事态严重性来讲：穿透 > 雪崩 > 击穿

1. 缓存穿透：请求数据库中根本就不存在的数据，既然数据库中都没有，缓存中更没有，导致每次请求直接怼到数据库；
2. 缓存雪崩：缓存在一时间点集中失效，导致缓存雪崩；
3. 缓存击穿：请求缓存中没有但是数据库中真实存在的数据，一般是缓存过期导致，也导致请求直接怼到数据库；

解决办法：

- 缓存穿透：最简单的就是利用布隆过滤器过滤非法key
- 缓存雪崩：设置key过期时间的时候加上一个随机数，关键点就在于让key错开时间失效；
- 缓存击穿：延长热点数据过期时间，或者直接设置永远不过期；

## **什么是Redis持久化？Redis有哪几种持久化方式？优缺点是什么？**

持久化：就是把内存的数据写入到磁盘中，防止宕机内存数据丢失。

Redis提供了两种持久化方式：**RDB（默认）和AOF**

- **RDB：** 快照形式是直接把内存中的数据保存到一个磁盘文件中，定时保存，保存策略。
- **AOF：** 把所有的对Redis的服务器进行修改的命令都存到一个文件里，命令的集合。

**RDB：**

rdb是Redis DataBase缩写

功能核心函数rdbSave(生成RDB文件)和rdbLoad（从文件加载内存）两个函数

![img](https://img2018.cnblogs.com/blog/1481291/201809/1481291-20180925141429889-1694430603.png).

**AOF:**

Aof是Append-only file缩写

![img](https://img2018.cnblogs.com/blog/1481291/201809/1481291-20180925141527592-2105439510.png).

每当执行服务器(定时)任务或者函数时flushAppendOnlyFile 函数都会被调用， 这个函数执行以下两个工作

AOF写入保存：

WRITE：根据条件，将 aof_buf 中的缓存写入到 AOF 文件

SAVE：根据条件，调用 fsync 或 fdatasync 函数，将 AOF 文件保存到磁盘中。

**比较**：

1、AOF文件比rdb更新频率高，优先使用AOF还原数据。

2、AOF比RDB更安全也更大

3、rdb性能比aof好

4、如果两个都配了优先加载AOF             



## **Redis是单线程的，为什么还能这么快？**

1. redis完全基于内存
2. 数据结构简单，对数据操作也简单
3. 采用单线程
4. 使用多路复用IO，非阻塞IO



